// ---------------------------------------------------------------------------

#ifndef frmMainUnitH
#define frmMainUnitH
// ---------------------------------------------------------------------------
#include <System.Classes.hpp>
#include <Vcl.Controls.hpp>
#include <Vcl.StdCtrls.hpp>
#include <Vcl.Forms.hpp>
#include <Vcl.ExtCtrls.hpp>
#include <Vcl.Menus.hpp>
#include <System.ImageList.hpp>
#include <Vcl.ImgList.hpp>
// ---------------------------------------------------------------------------
#include "lib/cfgmgr32.h"
#include "lokiCpp/common/Settings.h"
// ---------------------------------------------------------------------------
#include "Frame/frmLayoutChooserUnit.h"
#include "frame/model/views/frmReadingPaneUnit.h"
// ---------------------------------------------------------------------------
#include "frame/model/controllers/ctlSelfElevation.h"
// ---------------------------------------------------------------------------
#include "lib/imports/SSFTRSSOLOLib_OCX.h"
#include "lib/imports/SSFTRSSOLOLib_TLB.h"
#include <Vcl.ComCtrls.hpp>
#include <Vcl.AppEvnts.hpp>
// ---------------------------------------------------------------------------

int const WM_SHOW_KEY = WM_USER + 4;

HHOOK keyboardHook;
LRESULT CALLBACK LowLevelKeyboardProc(int nCode, WPARAM wParam, LPARAM lParam);

struct TKBDLLHOOKSTRUCT
{
	DWORD     vkCode;
	DWORD     scanCode;
	DWORD     flags;
	DWORD     time;
	ULONG_PTR dwExtraInfo;
};

struct TCurrentConfig
{
	bool Sound;
	bool Sounds;
	bool TTS;
	bool ActivateAfterWords;
	bool SelectionAndSpeaker;
	bool StartWithWindows;
	bool ReadAlong;

	bool KeboardConnected;

	int Volume;
	int ReadingSpeed;

	int CoverType;

} ;

// ---------------------------------------------------------------------------
// #include "lib/ve_engine_v2.0.0_win32/inc/ve_platform.h"
// #include "lib/ve_engine_v2.0.0_win32/inc/ve_ttsapi.h"
// ---------------------------------------------------------------------------
class TfrmMain :
	public TForm
{
	Ssftrssololib_tlb::TSsftRSSoloA *SsftRSSoloA1;
	lokiCpp::TSettings *d_settings;

	TctlSelfElevation *d_selfElevate;

	bool d_terminate;

	TfrmLayoutChooser *d_layoutSelection;

	NOTIFYICONDATA nid;
	HWND           hwnd;

	TCurrentConfig d_config;

__published: // IDE-managed Components

	TTrayIcon *         TrayIcon;
	TPopupMenu *        PopupMenu;
	TMenuItem *         mnuSound;
	TMenuItem *         mnuSounds;
	TMenuItem *         mnuTTS;
	TMenuItem *         mnuSettings;
	TMenuItem *         mnuManual;
	TMenuItem *         mnuClose;
	TImageList *        ImageList1;
	TMenuItem *         N1;
	TGroupBox *         gbOtherSettings;
	TGroupBox *         gbSoundSettings;
	TTrackBar *         tbVolume;
	TGroupBox *         gbTextToSpeech;
	TTrackBar *         tbSpeed;
	TCheckBox *         chkSound;
	TCheckBox *         chkSounds;
	TCheckBox *         chkTTS;
	TCheckBox *         chkWord;
	TCheckBox *         chkSelectionSpeakerKey;
	TLabel *            lblActivateAfter;
	TCheckBox *         chkAutomaticBoot;
	TButton *           cmdSave;
	TButton *           cmdApply;
	TButton *           cmdCancel;
	TApplicationEvents *ApplicationEvents1;
	TRadioButton *      rbClassic;
	TRadioButton *      rbCover;
	TCheckBox *         chkReadAlong;
	TLabel *            lblVolume;
	TLabel *            lblSpeed;

	void __fastcall PopupMenuItemClick(TObject *Sender);
	void __fastcall InstellingenClick(TObject *Sender);
	void __fastcall HandleidingClick(TObject *Sender);
	void __fastcall AfsluitenClick(TObject *Sender);
	void __fastcall FormCloseQuery(TObject *Sender, bool &CanClose);
	void __fastcall cmdSaveClick(TObject *Sender);
	void __fastcall ApplicationEvents1Idle(TObject *Sender, bool &Done);
	void __fastcall cmdApplyClick(TObject *Sender);

private: // User declarations
	void Init();

	void __fastcall WndProc(TMessage &Message);
	void __fastcall HandleConnectDisconnect();
	bool ParseSubNodes(PDEVINST parent, DEVINST hnode);

	void LoadSettings();
	void SaveSettings();

	void ClearSpeech();

public: // User declarations

	TfrmReadingPane *d_readingPane;

	void ProcessChar(String value);
	void ProcessText(String value);

	__fastcall TfrmMain(TComponent *Owner);
	__fastcall ~TfrmMain();
};

// ---------------------------------------------------------------------------
extern PACKAGE TfrmMain *frmMain;
// ---------------------------------------------------------------------------
#endif
